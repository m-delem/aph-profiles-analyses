
# Cluster radars

```{r}
#| label: plot-radars
#| fig-width: 8
#| fig-height: 4

df_clustered <- 
  df |> 
  # add_clusters(cluster_results$scaled,  "scaled") |>
  # add_clusters(cluster_results$reduced, "reduced") |>
  # mutate(across(contains("cluster"), ~ rename_clusters(., vviq))) |> 
  # align_clusters() |>
  scale_vars() |> 
  get_long_format() |> 
  mutate(
    Variable = 
      Variable |> 
      str_replace("Reading\ncomprehension", "Reading") |> 
      str_replace("Psi-Q Sensations", "Psi-Q Sens.") |> 
      str_replace("Psi-Q Feelings", "Psi-Q Feel.") |>  
      str_replace("Audition", "Auditory") |> 
      factor() |> 
      fct_inorder() |> 
      fct_relevel("VVIQ", after = Inf)
  )

p1 <-
  plot_clusters_radar(
    df_clustered,
    value ~ Variable + Cluster,
    palette = c("#56B4E9", "#E69F00", "#009E73")
  ) +
  theme(plot.margin = margin(0, 3.5, 0, 2, "mm"))

p2 <-
  plot_clusters_radar(
    df_clustered,
    value ~ Variable + Subcluster,
    palette = c("#56B4E9", "#E69F00", "#F5C710", "#009E73")
  ) +
   theme(plot.margin = margin(0, 2, 0, 3.5, "mm"))

p_radars <- p1 + p2

print(p_radars)

ggsave(
  filename = "figures/cluster-radars.pdf",
  plot = p_radars,
  width = 180,
  height = 90,
  units = "mm"
)
```

# Modelling

```{r}
#| label: modelling
#| warning: false

models_path <- here("data/r-data-structures/models.rds")
models <- list(
  group_models      = df2 |> scale_vars() |> get_longer() |> model_groups(groups = Group),
  cluster_models    = df2 |> scale_vars() |> get_longer() |> model_groups(groups = Cluster),
  subcluster_models = df2 |> scale_vars() |> get_longer() |> model_groups(groups = Subcluster)
  )
```

